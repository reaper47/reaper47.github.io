<!DOCTYPE html>
<html>
  <head>
    <title>Project: Mountain Range</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='../../css/ka-projects.css' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="../../js/vendor/processing.min.js"></script>
  </head>
  <body>
    <div class="container-khanacademy">
      <div class="container-text">
        <h2>Mountain Range</h2>
        <p>The goal of this project was to draw a mountain range using 
        <a href="https://en.wikipedia.org/wiki/Perlin_noise">Perlin noise</a>. 
        Not only are there mountain ranges, but also a layer of Perlin grass,
        noise and a layer of trees generated by noise. Every time the page is 
        refreshed, a new mountain range is generated.</p>
      </div>
      <div class="container-program">
        <canvas id="canvas"></canvas>
        <!-- Credits to Robert Tupelo-Schneck for this processingJS template -->
        <script>
          var canvas = document.getElementById("canvas");
          var processing = new Processing(canvas, function(processing) {
              processing.size(400, 400);
              processing.background(0xFFF);

              var mouseIsPressed = false;
              processing.mousePressed = function () { mouseIsPressed = true; };
              processing.mouseReleased = function () { mouseIsPressed = false; };

              var keyIsPressed = false;
              processing.keyPressed = function () { keyIsPressed = true; };
              processing.keyReleased = function () { keyIsPressed = false; };

              function getImage(s) {
                  var url = "https://www.kasandbox.org/programming-images/" + s + ".png";
                  processing.externals.sketch.imageCache.add(url);
                  return processing.loadImage(url);
              }

              // use degrees rather than radians in rotate function
              var rotateFn = processing.rotate;
              processing.rotate = function (angle) {
                  rotateFn(processing.radians(angle));
              };

              with (processing) {
                /***********************************************************
                This function draws a mountain
                 * incAmount: the amount the time will be increased
                 * heightDivider: how high the mountain will be
                 * desiredHeight: y-position where should the base be drawn
                ************************************************************/
                var drawRange = function(incAmount, heightDivider, desiredHeight) {
                    for (var t = 0; t < incAmount*width; t += incAmount) {
                        var n = noise(t);
                        var y = map(n, 0, 1, 0, height * (1/heightDivider));
                        line(t*1/incAmount, height-y, t*1/incAmount, desiredHeight);
                    }
                };

                // This function draws the cloudy, misty sky
                // Code comes from the "Two dimensional nosie" KA segment
                var drawSky = function(incAmount) {
                    var xoff = 0.0;
                    for (var x = 0; x < 400; x++) {
                        var yoff = 0.0;
                        for (var y = 0; y < 213; y++) {
                            var bright = map(noise(xoff, yoff), 0, 1, 0, 255);
                            stroke(bright, bright, bright);
                            point(x, y);
                            yoff += incAmount;
                        }
                        xoff += incAmount;
                    }
                };

                // This function constructs a simple triangular, green tree 
                var Tree = function(x, y, tall) {
                    this.x = x;
                    this.y = y;
                    this.tall = tall;
                    
                };

                // This method draws the tree constructor object
                Tree.prototype.draw = function() {
                    fill(16, 77, 2);
                    noStroke();
                    triangle(this.x, this.y, 
                             (this.x + this.tall/2), (this.y - this.tall), 
                             (this.x + this.tall), (this.y));
                };

                // Store random trees in an array
                var trees = [];
                for (var i = 0; i < 25; i++) {
                    trees.push(new Tree(random(width), random(245, 275), random(0, 8)));
                }

                drawSky(0.008);

                // Draw three mountain ranges by trial & error
                for (var i = 3; i > 0; i--) {
                    stroke(50 - (i*7));
                    drawRange(0.0022 + i*0.00248, 1.71 - i*0.35, height);
                }

                // Draw layers of grass at the base of the mountain ranges
                for (var i = 0; i < 4; i++) {
                    if (i === 0) {
                        stroke(55);
                        drawRange(0.002 + i*1000, 1.66 + i*2, height);
                    } else if (i === 1) { 
                        stroke(12, 82, 12);
                        drawRange(0.05, 1.5 + i*0.5, height);
                    } else if (i === 2) { 
                        stroke(7, 94, 4); 
                        drawRange(0.03, 1.5 + i*0.5, height);
                    } else if (i === 3) { 
                        stroke(16, 153, 11);
                        drawRange(0.002 + i*1000, 1.66 + i*2, height);
                    }
                }

                // Draw the array of random trees
                for (var i = 0; i < trees.length; i++) {
                    trees[i].draw();
                } 
              }
              if (typeof draw !== 'undefined') processing.draw = draw;
          });
        </script>
      </div>
    </div>
  </body>
</html>
